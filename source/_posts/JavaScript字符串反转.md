---
title: JavaScriptå­—ç¬¦ä¸²åè½¬
categories: JavaScript
tags:
  - JavaScript
date: 2018-05-04 11:29:39
---

å¸¸è§é¢è¯•é¢˜(é™¤äº†ä¸€äº›å­—ç¬¦ä¸²åŒ¹é…ç›¸å…³ç®—æ³•ä¼šç”¨åˆ°ä¼¼ä¹å¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…ç”¨å¤„?), çœ‹ä¼¼ç®€å•ä½†å´æœ‰å¾ˆå¤šè°œä¸€æ ·çš„case.

æœ€å¸¸è§çš„è§£æ³•å°±æ˜¯å°†å­—ç¬¦ä¸²åˆ‡æˆæ•°ç»„, å†åˆ©ç”¨æ•°ç»„çš„`reverse`æ–¹æ³•åè½¬åå†æ‹¼æ¥èµ·æ¥, å¦‚ä¸‹:

```
function reverse(str) {
  return Array.prototype.slice.call(str).reverse().join('');
}

reverse('abcde'); // "edcba"

reverse('æˆ‘ç³»æ¸£æ¸£è¾‰'); // "è¾‰æ¸£æ¸£ç³»æˆ‘"
```

è¿™æ ·çš„åšæ³•åœ¨é‡åˆ°å››å­—èŠ‚å­—ç¬¦æ—¶ä¼šå‡ºç°é—®é¢˜, å› ä¸ºåœ¨`slice`çš„æ—¶å€™ä¸€ä¸ªå››å­—èŠ‚å­—ç¬¦ä¼šè¢«åˆ†æˆä¸¤ä¸ªæ•°ç»„å…ƒç´ .

ä¾‹å¦‚é‡Œé¢åŒ…å«ä¸€ä¸ªç¬‘è„¸çš„emoji.
```
reverse('å’•å˜¿å˜¿ğŸ˜ƒ'); // "ï¿½ï¿½å˜¿å˜¿å’•"
```

ç”šè‡³æœ‰äº›çœ‹èµ·æ¥ä¼šæ¯”è¾ƒè¯¡å¼‚.

```
reverse('æ˜¯æ…Œ?è¿˜æ˜¯ğ¯¢§?è¿˜æ˜¯ğ¯¢©?'); // "?ï¿½ï¿½æ˜¯è¿˜?ï¿½ï¿½æ˜¯è¿˜?æ…Œæ˜¯"
```

ä¸Šé¢ä¸‰ä¸ª"æ…Œ"å­—çœ‹ä¸Šå»å¥½åƒæ˜¯ä¸€æ ·çš„, ä½†åé¢ä¸¤ä¸ª"æ…Œ"æ˜¯å››å­—èŠ‚å­—ç¬¦, ç”šè‡³è¿™ä¸¤ä¸ª"æ…Œ"çš„å­—ç¬¦ç¼–ç ä¹Ÿä¸ä¸€æ ·.

é‚£ä¹ˆè¿™åˆè¦æ€ä¹ˆè§£å†³å‘¢?

<!-- more -->

`ES6`å¯¹å­—ç¬¦ä¸²æ·»åŠ äº†è¿­ä»£å™¨, å¹¶ä¸”è¿™ä¸ªè¿­ä»£å™¨å¯ä»¥è¯†åˆ«å››å­—èŠ‚å­—ç¬¦. å¯ä»¥ç”¨`...`å°†å­—ç¬¦ä¸²åˆ‡æˆæ•°ç»„, è¿™æ ·å¯ä»¥ä¿è¯å››å­—èŠ‚å­—ç¬¦ä¸ä¼šè¢«åˆ†æˆä¸¤ä¸ª.

```
function reverse(str) {
  return [...str].reverse().join('');
}

reverse('å’•å˜¿å˜¿ğŸ˜ƒ'); // "ğŸ˜ƒå˜¿å˜¿å’•"

reverse('æ˜¯æ…Œ?è¿˜æ˜¯ğ¯¢§?è¿˜æ˜¯ğ¯¢©?'); // "?ğ¯¢©æ˜¯è¿˜?ğ¯¢§æ˜¯è¿˜?æ…Œæ˜¯"
```

ä¹Ÿå¯ä»¥åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†å››å­—èŠ‚å­—ç¬¦çš„å‰ä¸¤ä¸ªå­—èŠ‚ä¸åä¸¤ä¸ªå­—èŠ‚å…ˆäº¤æ¢ä¸€æ¬¡, å†ç”¨`slice`çš„æ–¹å¼è¿›è¡Œåè½¬.

```
function reverse(str) {
  str = str.replace(/([\uD800-\uDBFF])([\uDC00-\uDFFF])/g, (_, $1, $2) => `${$2}${$1}`);
  return Array.prototype.slice.call(str).reverse().join('');
}

reverse('æ˜¯æ…Œ?è¿˜æ˜¯ğ¯¢§?è¿˜æ˜¯ğ¯¢©?'); // "?ğ¯¢©æ˜¯è¿˜?ğ¯¢§æ˜¯è¿˜?æ…Œæ˜¯"

reverse('å’•å˜¿å˜¿ğŸ˜ƒ'); // "ğŸ˜ƒå˜¿å˜¿å’•"
```

è¿™é‡Œæ­£åˆ™çš„ä¾æ®æ˜¯`UTF16`ç¼–ç è§„åˆ™.

è¿™æ ·çš„è§£æ³•çœ‹ä¼¼æ˜¯æœ€ç»ˆç­”æ¡ˆ, ç›´åˆ°é‡åˆ°è¿™ä¸ªcase(æ¥æºäº[esrever](https://github.com/mathiasbynens/esrever)).

```
reverse('maÃ±ana manÌƒana'); // "anaÌƒnam anaÃ±am"
```

æ³¨æ„`~`çš„ä½ç½®.

åŸå› åœ¨äºå…¶ä¸­åŒ…å«ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦, å…¶ä½œç”¨æ˜¯è£…é¥°å‰ä¸€ä¸ªå­—ç¬¦(è£…é¥°å­—ç¬¦ç”šè‡³å¯ä»¥å åŠ å¤šä¸ª). ä¾‹å¦‚å­—ç¬¦ä¸²ä¸­ç¬¬äºŒä¸ª`~`. è¿™ä¸ªå­—ç¬¦çš„ç¼–ç ä¸º`\u0303`.

```
'\u0303' \\ "Ìƒ"

'a\u0303' \\ "aÌƒ"

'a\u0303\u0303' \\ "aÌƒÌƒ"

'a\u0303\u0305' \\ "aÌƒÌ…"
```

è§£å†³åŠæ³•å¯ä»¥çœ‹[esreverçš„å®ç°](https://github.com/mathiasbynens/esrever/blob/master/esrever.js#L20).

å…¶åˆ›å»ºäº†ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼, ç¬¬ä¸€ä¸ª`regexSymbolWithCombiningMarks`ç”¨æ¥åŒ¹é…æ™®é€šå­—ç¬¦åŠå…¶é™„å¸¦çš„è£…é¥°å­—ç¬¦, ç¬¬äºŒä¸ª`regexSurrogatePair`ç”¨æ¥åŒ¹é…å››å­—èŠ‚å­—ç¬¦.

åè½¬æ—¶å…ˆåŒ¹é…`regexSymbolWithCombiningMarks`, å°†é™„å¸¦çš„è£…é¥°å­—ç¬¦éƒ¨åˆ†åè½¬åæ”¾åœ¨æ™®é€šå­—ç¬¦å‰é¢; æ¥ç€å†åŒ¹é…æ‰€æœ‰å››å­—èŠ‚å­—ç¬¦, å¹¶äº¤æ¢å‰åä¸¤å­—èŠ‚ä½ç½®; æœ€åå†æ‰§è¡Œæ™®é€šçš„åè½¬æ“ä½œ(ä¸`slice`æ–¹æ³•æ•ˆæœç›¸åŒ).

`regexSymbolWithCombiningMarks`æ˜¯ç”±`allExceptCombiningMarks`å’Œ`combiningMarks`æ‹¼æ¥è€Œæˆ, è€Œè¿™ä¸¤è€…çš„è®¡ç®—åœ¨[/scripts/export-data.js](https://github.com/mathiasbynens/esrever/blob/master/scripts/export-data.js)ä¸­, å¯ä»¥çœ‹åˆ°è£…é¥°å­—ç¬¦æ˜¯ä»ä¸€ä¸ªé¢„å…ˆåˆ›å»ºå¥½çš„å­—ç¬¦åˆ†ç±»è¡¨å¾—åˆ°çš„, é€šè¿‡`regenerate`è®¡ç®—å‡º`allExceptCombiningMarks`å’Œ`combiningMarks`çš„æ­£åˆ™, å†ç”±Gruntæ›¿æ¢æºç ä¸­çš„å˜é‡å¾—åˆ°`regexSymbolWithCombiningMarks`.

æ‰€ä»¥...å¦‚æœçœŸæœ‰è¿™ç§ç‰¹æ®Šéœ€æ±‚çš„è¯, è¿˜æ˜¯è€è€å®å®ç”¨`esrever`å§.

### å‚è€ƒæ–‡çŒ®

[ECMAScript 6 å…¥é—¨ - æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨](http://es6.ruanyifeng.com/#docs/array#%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%BA%94%E7%94%A8)

[esrever](https://github.com/mathiasbynens/esrever)

[ç»´åŸºç™¾ç§‘UTF-16](https://zh.wikipedia.org/wiki/UTF-16)

[å­—ç¬¦ç ç‚¹æŸ¥è¯¢](https://codepoints.net/)
